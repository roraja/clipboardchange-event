<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

<!-- [for example.com] add the following to the head of any page -->
    <meta http-equiv="origin-trial" content="AkNLPHR1HO43IMV472ENEOGiEJLHPBoKyhDhttkSSA8H7puo/sHBWW+9HU20IZVlT8WHpDISnbKdv5kfG3D6VAIAAABeeyJvcmlnaW4iOiJodHRwczovL3JvcmFqYS5naXRodWIuaW86NDQzIiwiZmVhdHVyZSI6IkNsaXBib2FyZENoYW5nZUV2ZW50IiwiZXhwaXJ5IjoxNzY5NDcyMDAwfQ==">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clipboard Format Checker</title>
  </head>
  <body>
    <h1>Clipboardchange event demo app - Paste formats viewer - CHROME OT</h1>
    <p>
      This HTML application demonstrates the use of the clipboardchange event to
      monitor and display clipboard data in various formats. The app listens for
      changes to the clipboard using the clipboardchange event. The app displays
      the clipboard data in a table with columns for Text, Image, and HTML
      formats.
      <br />
      When the clipboard content changes, the app updates the table to show the
      current clipboard data. The app includes buttons for pasting clipboard
      data as Text, Image, and HTML. These buttons are initially disabled and
      are enabled based on the available clipboard formats.
    </p>
    <hr />
    <button id="pasteText" disabled>Paste as Text</button>
    <button id="pasteImg" disabled>Paste as Image</button>
    <button id="pasteHtml" disabled>Paste as HTML</button>
    <br />
    <hr />
    <table border="1">
      <thead>
        <tr>
          <th>Text</th>
          <th>Image</th>
          <th>HTML</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td id="clipboardText">N/A</td>
          <td id="clipboardImg">N/A</td>
          <td id="clipboardHtml">N/A</td>
        </tr>
      </tbody>
    </table>
    <button onclick="onRemoveClick();">RemoveListener</button>
    <div id="logContainer">LOGS:</div>
  </body>
  
  <script>
      const isClipboardChangeEventAvailable = true;

      
      function log(txt){

        const logDiv = document.getElementById('logContainer');
        const newLog = document.createElement('div');
        newLog.textContent = JSON.stringify(txt, null, 2);
        logDiv.appendChild(newLog);
      }

      async function checkClipboard(event) {
        try {
          log("Clipboard changed!");
          
          // First, update button states based on available types
          if (event && event.types) {
            log("Available types: " + JSON.stringify(event.types));
            
            const hasText = event.types.includes("text/plain");
            const hasImage = event.types.some(type => type.startsWith("image/"));
            const hasHtml = event.types.includes("text/html");
            
            document.getElementById("pasteText").disabled = !hasText;
            document.getElementById("pasteImg").disabled = !hasImage;
            document.getElementById("pasteHtml").disabled = !hasHtml;
          }
          
          // Then, read and display clipboard contents
          const clipboardItems = await navigator.clipboard.read();
          
          for (const item of clipboardItems) {
            // Handle text content
            if (item.types.includes("text/plain")) {
              const textBlob = await item.getType("text/plain");
              const text = await textBlob.text();
              document.getElementById("clipboardText").innerText = text;
            } else {
              document.getElementById("clipboardText").innerText = "N/A";
            }
            
            // Handle image content
            const imageType = item.types.find(type => type.startsWith("image/"));
            if (imageType) {
              const imgBlob = await item.getType(imageType);
              const imgUrl = URL.createObjectURL(imgBlob);
              document.getElementById("clipboardImg").innerHTML = 
                `<img src="${imgUrl}" alt="Clipboard Image" width="150">`;
            } else {
              document.getElementById("clipboardImg").innerText = "N/A";
            }
            
            // Handle HTML content
            if (item.types.includes("text/html")) {
              const htmlBlob = await item.getType("text/html");
              const html = await htmlBlob.text();
              document.getElementById("clipboardHtml").innerText = html;
            } else {
              document.getElementById("clipboardHtml").innerText = "N/A";
            }
          }
        } catch (err) {
          log("Failed to read clipboard contents: " + err.message);
          console.error("Failed to read clipboard contents: ", err);
        }
      }

      if ('onclipboardchange' in navigator.clipboard) {
        log("Clipboardchange event supported - adding listener");
        
        // Start listening to the clipboardchange event
        navigator.clipboard.addEventListener("clipboardchange", checkClipboard);
        
        // Initialize current state
        checkClipboard();
      } else {
        log("Clipboardchange event not supported - using polling fallback");
        
        // Fallback to polling every 2 seconds
        checkClipboard();
        setInterval(checkClipboard, 2000);
      }

      function onRemoveClick(){
        log("Removing handler");
            navigator.clipboard.removeEventListener(
              "clipboardchange",
              checkClipboard
            );

      }
    </script>
</html>
